document.addEventListener("DOMContentLoaded", () => {
  const quizForm = document.getElementById("quizForm");
  const submitBtn = document.getElementById("submitBtn");
  const resultDiv = document.getElementById("result");

  // 질문 렌더링
  questions.forEach((item, index) => {
    const qDiv = document.createElement("div");
    qDiv.classList.add("question");
    qDiv.innerHTML = `<p>${item.q}</p>`;
    item.options.forEach(opt => {
      const label = document.createElement("label");
      label.innerHTML = `<input type="radio" name="q${index}" value="${opt.value}"> ${opt.text}`;
      qDiv.appendChild(label);
    });
    quizForm.appendChild(qDiv);
  });

  // 제출 버튼 클릭 이벤트
  submitBtn.addEventListener("click", () => {
    let scores = { G: 0, T: 0, A: 0, H: 0 };

    questions.forEach((_, index) => {
      const selected = document.querySelector(`input[name="q${index}"]:checked`);
      if (selected) scores[selected.value]++;
    });

    // 상위 2개 유형 추출
    const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
    const top2 = sorted.slice(0, 2).map(s => s[0]).join("");

    // angels.json 불러오기
    fetch("angels.json")
      .then(res => res.json())
      .then(data => {
        const angel = data.find(a => a.type === top2);
        if (angel) {
          resultDiv.innerHTML = `
            <p><strong>${angel.title}</strong></p>
            <p>${angel.description}</p>
            <p>${angel.keywords}</p>
            <p>${angel.growth}</p>
          `;
        } else {
          resultDiv.innerHTML = "<p>해당되는 엔젤 유형을 찾을 수 없습니다.</p>";
        }
      });
  });
});
